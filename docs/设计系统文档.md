# 设计系统文档

**版本**: 2.0（情感化设计）  
**更新日期**: 2026年2月12日

---

## 1. 概述

本文档整合了偏头痛记录 App 的设计系统规范，涵盖主题、颜色、组件、动画、图标资源与可访问性。设计原则：**情感化**（温暖、治愈、鼓励）、**一致性**（8pt 网格、统一圆角）、**可访问**（44pt 触控目标、VoiceOver 支持）。

---

## 2. 主题系统

### 2.1 三种主题模式

| 模式 | 说明 |
|------|------|
| 跟随系统 | 自动跟随 iOS 系统设置 |
| 浅色模式 | 始终使用浅色主题 |
| 深色模式 | 始终使用深色主题 |

### 2.2 ThemeManager

```swift
@Observable
class ThemeManager {
    var currentTheme: AppTheme
    func setTheme(_ theme: AppTheme)
}

enum AppTheme: String {
    case system = "跟随系统"
    case light = "浅色模式"
    case dark = "深色模式"
}
```

主题偏好保存在 `UserDefaults`，通过 `environment(themeManager)` 注入，在 `applyAppTheme()` 中应用。入口：**设置 → 外观 → 主题设置**。

### 2.3 颜色映射（浅色/深色）

| 颜色名称 | 浅色模式 | 深色模式 |
|---------|----------|----------|
| `backgroundPrimary` | 白色 | 黑色 |
| `backgroundSecondary` | #F2F2F7 | #1C1C1E |
| `textPrimary` | 黑色 | 白色 |
| `textSecondary` | #3C3C43 99% | #EBEBF5 60% |
| `divider` | #3C3C43 36% | #545458 65% |

```swift
// 使用系统颜色（自动适配）
Text("标题").foregroundColor(AppColors.textPrimary)
VStack { }.background(AppColors.backgroundSecondary)
```

---

## 3. 颜色体系

### 3.1 主色调

```swift
Color.accentPrimary      // #5EC4B6 治愈蓝绿
Color.accentSecondary    // #4A90E2 柔和蓝
Color.warmAccent         // #F4A261 温暖橙
Color.gentlePink         // #E8A0BF 柔和粉
```

### 3.2 渐变

```swift
Color.primaryGradient    // 蓝绿→蓝（主按钮）
Color.warmGradient       // 橙→黄（正向提示）
```

### 3.3 疼痛强度色阶

| 分数 | 颜色 | 色值 |
|------|------|------|
| 0-2 | 薄荷绿 | #A8D5BA |
| 3-4 | 柔黄 | #F4E285 |
| 5-6 | 温橙 | #F4B860 |
| 7-8 | 珊瑚 | #E89A81 |
| 9-10 | 柔红 | #D17A7A |

### 3.4 语义色

```swift
Color.statusSuccess
Color.statusWarning
Color.statusError
Color.statusInfo
```

### 3.5 特殊情感色

`warmAccent`、`gentlePink`、`accentPrimary`、`accentSecondary` 用于正向鼓励场景，**不会自动适配暗模式**，使用时需注意对比度。

---

## 4. 组件库

### 4.1 卡片组件

| 样式 | 使用场景 |
|------|----------|
| `EmotionalCard(.default)` | 普通信息展示 |
| `EmotionalCard(.elevated)` | 重要信息、概览（浮起效果） |
| `EmotionalCard(.gentle)` | 友好提示、建议 |
| `EmotionalCard(.warning)` | 警告、MOH 风险 |
| `EmotionalCard(.success)` | 正向反馈、完成状态 |

```swift
EmotionalCard(style: .elevated) {
    Text("重要信息")
}

InfoCard { Text("内容") }  // 向后兼容
```

### 4.2 按钮组件

| 组件 | 用途 | 最小尺寸 |
|------|------|----------|
| `PrimaryButton` | 主要操作 | 高度 56pt |
| `SecondaryButton` | 次要操作 | 高度 56pt |
| `IconButton` | 图标操作 | 44×44pt |
| `SelectableChip` | 多选标签 | 高度 32pt |
| `BreathingRecordButton` | 首页主按钮 | 直径 120pt |

```swift
// 渐变主按钮
.background(Color.primaryGradient)
.foregroundStyle(.white)
.cornerRadius(16)
```

### 4.3 输入组件

| 组件 | 用途 | 特性 |
|------|------|------|
| `CircularSlider` | 疼痛强度 | 360° 拖动、触觉反馈 |
| `HorizontalPainSlider` | 疼痛强度（线性） | 传统滑块 |
| `HeadMapView` | 疼痛部位 | 交互式头部地图 |
| `SelectableChip` | 多选项 | 带图标、触觉反馈 |

### 4.4 反馈组件

| 组件 | 用途 |
|------|------|
| `EncouragingText` | 鼓励文案（出现动画） |
| `AnimatedNumber` | 数字变化（滚动动画） |
| `LoadingView` | 加载状态（呼吸动画） |
| `ToastView` | 轻提示（滑入+淡出） |

```swift
EncouragingText(type: .streak(days: 7))
EncouragingText(type: .firstRecord)
AnimatedNumber(value: streakDays).font(.largeTitle.bold())
```

---

## 5. 动画系统

### 5.1 EmotionalAnimation 类型

```swift
EmotionalAnimation.gentleConfirm   // 确认、完成
EmotionalAnimation.breathe         // 呼吸效果（主按钮）
EmotionalAnimation.fluid           // 进度条、流体
```

### 5.2 时长标准

| 类型 | 时长 | 场景 |
|------|------|------|
| 快速 | 0.15s | 按钮按压 |
| 标准 | 0.3s | 页面切换 |
| 舒缓 | 0.5s | 数据加载 |
| 呼吸 | 2.0s | 待机动画 |

### 5.3 使用示例

```swift
withAnimation(EmotionalAnimation.gentleConfirm) {
    isComplete = true
}
.scaleEffect(isBreathing ? 1.1 : 1.0)
.animation(EmotionalAnimation.breathe, value: isBreathing)
```

### 5.4 触觉反馈

```swift
// 选择/切换
UIImpactFeedbackGenerator(style: .light).impactOccurred()

// 保存完成
UINotificationFeedbackGenerator().notificationOccurred(.success)
```

系统会检测「减弱动画」设置，动画时长控制在 0.3s 以内（除呼吸动画外）。

---

## 6. 间距与圆角

### 6.1 8pt 网格

```swift
Spacing.xxs  // 4pt
Spacing.xs   // 8pt
Spacing.sm   // 12pt
Spacing.md   // 16pt
Spacing.lg   // 24pt
Spacing.xl   // 32pt
Spacing.xxl  // 48pt
```

### 6.2 圆角规范

```swift
CornerRadius.sm   // 8pt  - 小标签
CornerRadius.md   // 12pt - 卡片
CornerRadius.lg   // 16pt - 大卡片
CornerRadius.xl   // 24pt - 按钮
CornerRadius.full // 999pt - 圆形
```

---

## 7. 图标与插画资源

### 7.1 Lucide 图标

- **来源**：https://lucide.dev/icons/
- **导入**：SVG 放入 `Assets.xcassets/Lucide/`，设为 Template Image
- **使用**：

```swift
LucideIconView(.heart, size: 24, color: .accentPrimary)
LucideIcon.heart.image
LucideIconView(.heart, useSFSymbolFallback: true)  // 后备
```

按类别组织约 60+ 图标：医疗健康、记录、数据分析、情感化、界面操作、功能图标。

### 7.2 unDraw 插画

| 场景 | 用途 |
|------|------|
| notebook | Onboarding 第 1 屏 |
| security | 隐私说明 |
| empty | 首页空状态 |
| success | 完成/庆祝 |
| analytics | 分析页空状态 |

可先用主色 `#5EC4B6` 在 unDraw 网站自定义配色后下载。

### 7.3 SF Symbols 后备

未下载 Lucide/unDraw 资源时，已实现 SF Symbols 后备，App 可正常运行。

### 7.4 许可

- **Lucide**：ISC，商业可用，无需署名
- **unDraw**：MIT，商业可用
- **SF Symbols**：Apple License，仅限 Apple 平台

---

## 8. 可访问性

- **最小触控目标**：44×44pt（使用 `.minimumTouchTarget()`）
- **VoiceOver**：为按钮/芯片添加 `accessibilityLabel` 和 `accessibilityHint`
- **动态字体**：支持系统文字大小设置
- **减弱动画**：检测用户设置，避免过度动画

```swift
Button { } label: { Image(systemName: "trash") }
    .accessibilityLabel("删除")
    .accessibilityHint("双击删除此记录")
    .minimumTouchTarget()

SelectableChip(label: "压力", isSelected: $isSelected,
    accessibilityHint: "点击选择或取消选择此诱因")
```

---

## 9. 迁移指南

| 旧版 | 新版 |
|------|------|
| `Color.accentColor` | `Color.accentPrimary` |
| `InfoCard { }` | `EmotionalCard(style: .default) { }`（InfoCard 仍可用） |
| `AppAnimation.standard` | `EmotionalAnimation.gentleConfirm` / `.breathe` |
| `.foregroundColor(.white)` | `AppColors.textPrimary` |
| `.background(Color.black)` | `AppColors.backgroundPrimary` |

---

## 10. 相关文件

| 文件 | 说明 |
|------|------|
| `DesignSystem/Colors.swift` | 颜色定义 |
| `DesignSystem/ThemeManager.swift` | 主题管理器 |
| `DesignSystem/Spacing.swift` | 间距系统 |
| `DesignSystem/Components/` | 卡片、按钮等组件 |
| `Views/Settings/ThemeSettingsView.swift` | 主题设置页 |
| `migraine_noteApp.swift` | 应用入口、主题注入 |

---

**维护者**: Design Team  
**问题反馈**: 项目 issue
