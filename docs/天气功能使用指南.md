# 天气功能使用指南

## 功能概述

偏头痛记录应用现已集成天气追踪功能，帮助您了解环境因素（特别是气压变化）与偏头痛发作的关系。

## 首次设置

### 1. 授权位置权限

首次打开应用时，系统会请求位置权限：

1. 点击"允许一次"或"使用App时允许"
2. 应用将使用您的位置获取当地天气数据
3. 如果拒绝，可以稍后在系统设置中修改

**前往设置路径**: 
设置 → 隐私与安全性 → 定位服务 → 偏头痛记录 → 选择"使用App时"

### 2. 查看首页天气

授权后，首页会自动显示当前天气信息：

- **温度**: 当前实时温度
- **位置**: 当前城市
- **气压**: 大气压力值及趋势（↑上升 / ↓下降 / —平稳）
- **湿度**: 空气湿度百分比
- **风险警告**: 可能触发偏头痛的天气条件

## 使用场景

### 场景 1: 创建新记录

**自动记录天气**

当您创建新的偏头痛记录时：

1. 点击首页"开始记录"按钮
2. 填写疼痛强度、部位等信息
3. 点击"完成记录"
4. ✨ **天气数据会自动关联到这条记录**

**无需任何手动操作！**

### 场景 2: 查看历史记录

在记录详情页面，您可以看到：

- 发作时的天气状况
- 气压、温度、湿度数据
- 是否存在天气风险因素

### 场景 3: 数据分析

在分析页面，您可以：

- 查看天气与发作频率的关联
- 发现个人的天气敏感性
- 获得基于天气的预防建议

## 天气风险提示

### 🌡️ 气压警告

**触发条件**: 
- 气压 < 1010 hPa
- 且气压呈下降趋势

**提示**: "气压骤降，可能触发头痛"

**建议**:
- 提前服用预防性药物
- 避免剧烈运动
- 保持充足休息

### 💧 湿度警告

**触发条件**: 湿度 > 80%

**提示**: "高湿度环境，注意防湿"

**建议**:
- 使用除湿器
- 保持室内通风
- 避免长时间户外活动

### 🌡️ 温度警告

**高温**: 温度 > 35°C
**提示**: "高温天气，注意防暑"

**低温**: 温度 < 0°C
**提示**: "气温过低，注意保暖"

**建议**:
- 避免极端温度环境
- 保持适宜的室内温度
- 注意头部保暖/防晒

## 隐私说明

### 位置数据使用

✅ **应用仅在使用时获取位置**
- 不会在后台追踪您的位置
- 位置数据仅用于获取天气信息
- 不会存储精确的地理坐标

✅ **数据存储**
- 仅保存城市名称（如"北京"）
- 所有数据存储在您的 iCloud 私有数据库
- 开发者无法访问您的数据

✅ **随时可撤销权限**
- 前往系统设置修改位置权限
- 撤销后不影响应用的其他功能
- 仅天气功能会失效

## 常见问题

### Q: 为什么首页没有显示天气？

**可能原因**:
1. **未授权位置权限** → 前往系统设置授权
2. **网络未连接** → 检查网络连接
3. **定位服务关闭** → 在系统设置中开启定位服务

### Q: 天气数据多久更新一次？

- **首页**: 每次打开应用时更新
- **记录**: 创建记录时获取当时的实时数据
- 可以下拉刷新首页更新天气

### Q: 可以查看历史天气吗？

- WeatherKit 支持查询最近 10 天的历史天气
- 编辑旧记录时，会尝试获取当时的天气数据
- 10 天以前的记录无法补充天气数据

### Q: 在国外可以使用吗？

✅ 可以！WeatherKit 支持全球范围
- 自动根据您的位置获取当地天气
- 温度单位自动适配（°C/°F）

### Q: 天气数据会占用很多流量吗？

不会。天气数据非常轻量：
- 单次请求约 1-2 KB
- 每天平均使用流量 < 50 KB
- 建议在 Wi-Fi 环境下首次使用

### Q: 如果天气获取失败怎么办？

- 不会影响记录的保存
- 记录会正常保存，只是缺少天气数据
- 稍后可以在有网络时查看历史记录的天气

## 最佳实践

### 📊 建立天气日记

连续使用 1-2 个月后，您可以：

1. **识别个人敏感因素**
   - 查看哪些天气条件最容易触发发作
   - 气压变化？温度变化？湿度？

2. **制定预防策略**
   - 关注天气预报
   - 在敏感天气来临前做好准备
   - 调整活动安排

3. **与医生沟通**
   - 导出医疗报告（含天气数据）
   - 帮助医生了解环境诱因
   - 制定个性化治疗方案

### 🎯 结合其他数据

天气数据与以下因素结合分析：

- **睡眠质量**: 睡眠不足 + 气压下降 = 高风险
- **月经周期**: 经期 + 高湿度 = 高风险  
- **压力水平**: 高压力 + 温度变化 = 高风险

## 技术细节

### 数据来源

- **天气服务**: Apple WeatherKit
- **位置服务**: CoreLocation
- **精度**: 城市级别（千米级精度）

### 支持系统

- iOS 17.0 及以上
- 需要网络连接
- 真机运行（模拟器可能不可用）

### 数据字段

每条记录保存的天气信息：

```
- 时间戳
- 气压（hPa）
- 气压趋势（上升/下降/稳定）
- 温度（°C）
- 湿度（%）
- 风速（m/s）
- 天气状况（晴/云/雨/雪等）
- 城市名称
```

## 反馈与建议

如果您有任何问题或建议，欢迎联系我们：

- 📧 邮箱: support@example.com
- 💬 GitHub: [项目地址]

---

**享受更智能的偏头痛管理体验！** 🌤️
