# 测试数据功能使用说明

## 概述

测试数据功能仅在 **Debug 编译模式**下可用，用于快速生成模拟数据以测试应用功能。

## 访问方式

1. 运行应用（Debug 模式）
2. 进入「我的」Tab
3. 滚动到底部，找到「测试与调试」卡片
4. 点击「测试数据」进入测试数据管理界面

## 功能说明

### 1. 数据统计

显示当前数据库中的数据概况：
- 发作记录数量
- 药物数量
- 自定义标签数量

### 2. 发作记录生成

**参数配置：**
- **月份数**（1-24个月）：生成过去几个月的数据
- **每月频次**（1-15次）：每月发作次数
- **平均持续时长**（1-24小时）：发作平均持续时间
- **时长变化范围**（0-12小时）：持续时间的波动范围

**生成规则：**
- 时间分布：70%随机 + 30%规律（周末偏多）
- 疼痛强度：正态分布（均值6-7）
- 疼痛部位：70%单侧，30%双侧或全头
- 症状：80%常见症状（恶心、畏光等），20%罕见症状
- 诱因：重复常见诱因（压力、睡眠、饮食等）
- 用药：70%记录有用药
- 包含天气数据快照

**示例：**
- 生成6个月数据，每月4次，平均持续4小时 → 约24条记录

### 3. 药箱数据生成

**参数配置：**
- **药品数量**（5-30种）：生成的药物种类数

**生成规则：**
- 按类别生成：NSAID、曲普坦类、预防性药物、中成药、麦角胺类
- 自动设置标准剂量和单位
- 随机库存（5-50片）
- 急性药物自动设置月度限制

### 4. 自定义标签生成

**参数配置：**
- **标签数量**（5-20个）：生成的自定义标签数

**生成规则：**
- 症状标签：头晕目眩、耳鸣、口干等
- 诱因标签：看手机过久、吹空调、坐姿不正等

### 5. 数据清空

#### 选择性清空
可单独清空：
- 发作记录
- 药箱数据
- 自定义标签

#### 清空所有数据
**安全流程（三重确认）：**
1. 第一次确认：弹窗警告
2. 第二次确认：输入"确认删除"
3. 第三次确认：显示即将删除的数据量，最后确认

**注意：所有清空操作不可恢复！**

## 使用场景

### 测试场景1：数据展示测试
```
生成参数：
- 月份数：3个月
- 每月频次：2-3次
- 持续时长：2-4小时
- 药品：5-8种

用途：测试首页、列表页、统计页的数据展示
```

### 测试场景2：统计分析测试
```
生成参数：
- 月份数：12个月
- 每月频次：4-8次
- 持续时长：2-8小时
- 药品：10-15种

用途：测试年度统计、趋势分析、MOH检测
```

### 测试场景3：极端数据测试
```
生成参数：
- 月份数：24个月
- 每月频次：10-15次
- 持续时长：1-12小时
- 药品：20-30种

用途：测试性能、数据库压力、UI极限情况
```

## 数据特性

### 平衡模式设计
生成的数据模拟真实患者模式：
- 周末发作概率略高
- 压力、睡眠不足等常见诱因出现频率高
- 疼痛强度集中在中高等级（6-8分）
- 常见症状组合（恶心+畏光+头痛）

### 数据完整性
- 所有生成的记录包含必要字段
- 关系正确建立（用药记录 → 药物 → 发作记录）
- 时间戳合理（发作时间 > 诱因时间 > 用药时间）
- 遵循业务规则（如MOH检测阈值）

## 注意事项

### ⚠️ 重要提醒

1. **仅 Debug 模式可用**
   - Release 构建不会包含此功能
   - 生产环境完全不可见

2. **数据会真实保存**
   - 生成的数据会保存到 SwiftData 数据库
   - 会同步到 iCloud（如果已登录）
   - 建议使用测试 Apple ID

3. **清空操作不可恢复**
   - 清空后数据永久删除
   - iCloud 同步的数据也会被删除
   - 请谨慎操作

4. **性能考虑**
   - 生成大量数据（如24个月×15次）可能需要几秒钟
   - 首次生成药物数据会创建5种基础药物
   - 建议从小数据量开始测试

## 故障排除

### Q: 点击生成按钮没有反应？
A: 检查是否正在生成中（按钮显示"生成中..."），等待完成后再次尝试。

### Q: 生成的数据没有显示？
A: 返回主页面，下拉刷新。数据可能需要几秒钟才能同步。

### Q: 清空数据失败？
A: 确保没有其他操作正在进行，重新尝试。如果持续失败，重启应用。

### Q: Release 版本如何隐藏此功能？
A: 使用 Release 配置编译，所有 `#if DEBUG` 块中的代码都不会被编译进去。

## 技术细节

### 环境检测
```swift
#if DEBUG
// 测试功能代码
#endif
```

### 随机数生成
- 正态分布：Box-Muller 变换
- 时间分布：Calendar + DateComponents
- 权重随机：基于概率阈值

### 数据模型
- AttackRecord（发作记录）
- Symptom（症状）
- Trigger（诱因）
- MedicationLog（用药记录）
- Medication（药物）
- WeatherSnapshot（天气快照）
- CustomLabelConfig（自定义标签）

## 开发建议

### 测试工作流
1. **初始测试**：生成少量数据（1个月，2-3次）
2. **功能测试**：生成中等数据（3-6个月，3-5次）
3. **压力测试**：生成大量数据（12-24个月，8-15次）
4. **清理环境**：测试完成后清空所有数据

### 最佳实践
- 每次测试前清空旧数据
- 使用不同参数组合测试各种场景
- 记录异常数据或边界情况
- 定期验证数据完整性

## 更新日志

### v1.0.0 (2026-02-02)
- 初始版本
- 支持发作记录、药箱、自定义标签生成
- 实现三重确认的数据清空流程
- 平衡模式数据生成策略
- 仅 Debug 模式可用
